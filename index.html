<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è“å±±äºº</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #050505;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            overflow: hidden;
            color: white;
            user-select: none;
        }

        /* ç²’å­å®¹å™¨ */
        #canvas-container {
            position: relative;
            width: 400px;
            height: 400px;
            /* ç¨å¾®åŠ ç‚¹è“è‰²å…‰æ™•èƒŒæ™¯ */
            background: radial-gradient(circle, rgba(64, 150, 255, 0.05) 0%, transparent 70%);
            cursor: pointer;
        }

        /* æ°”æ³¡å¯¹è¯æ¡† */
        #chat-bubble {
            position: absolute;
            top: 0px;
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 25px;
            border-radius: 25px;
            font-size: 16px;
            color: #333;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            pointer-events: none;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            font-weight: bold;
            text-align: center;
            white-space: pre-wrap; /* æ”¯æŒæ¢è¡Œ */
            z-index: 10;
            max-width: 280px;
        }
        #chat-bubble.show {
            opacity: 1;
            transform: translateX(-50%) translateY(-20px);
        }
        /* æ°”æ³¡çš„å°å°¾å·´ */
        #chat-bubble::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            border-width: 10px 10px 0;
            border-style: solid;
            border-color: rgba(255, 255, 255, 0.95) transparent transparent transparent;
        }

        /* åº•éƒ¨æ§åˆ¶åŒº */
        #controls {
            position: fixed;
            bottom: 50px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            z-index: 20;
        }

        /* éº¦å…‹é£æŒ‰é’® */
        #mic-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: rgba(255,255,255,0.05);
            border: 2px solid #4facfe;
            color: #4facfe;
            font-size: 30px;
            cursor: pointer;
            box-shadow: 0 0 20px rgba(79, 172, 254, 0.2);
            transition: all 0.3s;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #mic-btn:hover {
            background: rgba(79, 172, 254, 0.1);
            transform: scale(1.05);
        }
        #mic-btn:active, #mic-btn.listening {
            background: #4facfe;
            color: #000;
            box-shadow: 0 0 40px #4facfe;
            transform: scale(0.95);
        }
        #mic-btn.listening {
            animation: pulse 1.5s infinite;
        }

        #tips {
            font-size: 14px;
            color: rgba(255,255,255,0.5);
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(79, 172, 254, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(79, 172, 254, 0); }
            100% { box-shadow: 0 0 0 0 rgba(79, 172, 254, 0); }
        }
    </style>
</head>
<body>

    <div id="canvas-container">
        <div id="chat-bubble">ä½ å¥½ï¼Œæˆ‘æ˜¯è“å±±äººã€‚<br>æ²¡äº‹åˆ«æˆ³æˆ‘ã€‚</div>
        <canvas id="particleCanvas"></canvas>
    </div>

    <div id="controls">
        <div id="tips">ç‚¹å‡»éº¦å…‹é£ï¼Œç›´æ¥ä¸‹æŒ‡ä»¤ (æ— éœ€å”¤é†’è¯)</div>
        <button id="mic-btn" title="æŒ‰ä½è¯´è¯">ğŸ™ï¸</button>
    </div>

    <script>
        // --- 1. æ ¸å¿ƒå˜é‡ä¸è®¾ç½® ---
        const canvas = document.getElementById('particleCanvas');
        const ctx2d = canvas.getContext('2d');
        canvas.width = 400;
        canvas.height = 400;

        let mouseX = -1000, mouseY = -1000;
        let particles = [];
        const particleCount = 350; // ç²’å­ç¨å¾®å¤šä¸€ç‚¹
        let state = "idle"; 
        let time = 0;
        
        // è´±èŒæ–‡æ¡ˆé…ç½®
        const introText = "ä½ å¥½ï¼Œæˆ‘æ˜¯è“å±±äººã€‚\næœ‰è¯å¿«è¯´ï¼Œæˆ‘å¾ˆå¿™çš„ã€‚";

        // --- 2. è¯­éŸ³è¯†åˆ« (Web Speech API) ---
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const micBtn = document.getElementById('mic-btn');
        let recognition;

        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.lang = 'zh-CN';
            recognition.continuous = false; // è¯´å®Œä¸€å¥è‡ªåŠ¨ç»“æŸï¼Œé¿å…æ··ä¹±
            recognition.interimResults = false;

            recognition.onstart = () => { micBtn.classList.add('listening'); showBubble("æ­£åœ¨å¬... (åˆ«å¤ªå°å£°)"); };
            recognition.onend = () => { micBtn.classList.remove('listening'); };
            
            recognition.onresult = (event) => {
                const text = event.results[0][0].transcript;
                console.log("æ”¶åˆ°è¯­éŸ³:", text);
                processCommand(text); // ç›´æ¥å¤„ç†ï¼Œä¸éœ€è¦è¿‡æ»¤å”¤é†’è¯
            };

            micBtn.onclick = () => {
                try { recognition.start(); } catch(e) { recognition.stop(); }
            };
        } else {
            micBtn.style.display = 'none';
            document.getElementById('tips').innerText = "å½“å‰æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³ï¼Œè¯·ä½¿ç”¨ Chrome/Edge";
        }

        // --- 3. ç²’å­ç³»ç»Ÿ (ç‰©ç†ä¸å½¢çŠ¶) ---
        class Particle {
            constructor() {
                this.x = 200 + (Math.random()-0.5)*50;
                this.y = 200 + (Math.random()-0.5)*50;
                this.vx = 0; this.vy = 0;
                this.friction = 0.92;
                this.speed = Math.random() * 0.08 + 0.04;
                this.baseColor = `rgba(79, 172, 254, ${Math.random()*0.4 + 0.6})`; // è“å±±äººçš„ä¸»è‰²è°ƒï¼šå¤©è“
                this.color = this.baseColor;
                this.size = Math.random() * 2 + 1;
            }

            update(targetX, targetY, loose) {
                // é¼ æ ‡æ–¥åŠ›
                const dx_mouse = this.x - mouseX;
                const dy_mouse = this.y - mouseY;
                const dist_mouse = Math.sqrt(dx_mouse*dx_mouse + dy_mouse*dy_mouse);
                if (dist_mouse < 100) {
                    const force = (100 - dist_mouse) / 100;
                    const angle = Math.atan2(dy_mouse, dx_mouse);
                    this.vx += Math.cos(angle) * force * 3;
                    this.vy += Math.sin(angle) * force * 3;
                }

                // ç›®æ ‡å¸åŠ›
                const dx = targetX - this.x;
                const dy = targetY - this.y;
                this.vx += dx * this.speed;
                this.vy += dy * this.speed;

                if (loose) { // å¢åŠ éšæœºæ‰°åŠ¨
                    this.vx += (Math.random()-0.5) * 1.5;
                    this.vy += (Math.random()-0.5) * 1.5;
                }

                this.vx *= this.friction;
                this.vy *= this.friction;
                this.x += this.vx;
                this.y += this.vy;
            }

            draw() {
                ctx2d.fillStyle = this.color;
                ctx2d.beginPath();
                ctx2d.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx2d.fill();
            }
        }

        // åˆå§‹åŒ–
        for(let i=0; i<particleCount; i++) particles.push(new Particle());

        // åŠ¨ç”»å¾ªç¯
        function animate() {
            ctx2d.clearRect(0, 0, 400, 400);
            time += 0.05;

            particles.forEach((p, index) => {
                let tx, ty, loose = true;

                // --- å½¢çŠ¶é€»è¾‘ ---
                if (state === "idle") {
                    // é»˜è®¤å‘¼å¸çƒ
                    const angle = index; 
                    const r = 70 + Math.sin(time + index/20) * 5; 
                    tx = 200 + Math.cos(angle) * r;
                    ty = 200 + Math.sin(angle) * r;
                } 
                else if (state === "heart") {
                    // çˆ±å¿ƒæ–¹ç¨‹
                    // x = 16sin^3(t), y = 13cos(t)-5cos(2t)-...
                    const t = (index / particleCount) * Math.PI * 2;
                    const r = 8; // ç¼©æ”¾ç³»æ•°
                    tx = 200 + r * (16 * Math.pow(Math.sin(t), 3));
                    ty = 200 - r * (13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t));
                    ty -= 10; // ç¨å¾®å¾€ä¸Šæä¸€ç‚¹
                    loose = false; // çˆ±å¿ƒè¦ç´§å‡‘ä¸€ç‚¹
                    p.color = "#ff6b81"; // å˜ç²‰çº¢
                }
                else if (state === "doc") {
                    // çŸ©å½¢æ–‡æ¡£ (è€æ¿æ¥äº†)
                    const side = Math.sqrt(particleCount);
                    const row = Math.floor(index / side);
                    const col = index % side;
                    // å±…ä¸­ç»˜åˆ¶çŸ©å½¢
                    tx = 130 + col * 8; 
                    ty = 130 + row * 8;
                    loose = false;
                    p.color = "#ffffff"; // å˜æˆç™½çº¸
                }
                else if (state === "stand") {
                    // ç«™ç«‹å½¢æ€
                    if (index < 60) { // å·¦è…¿
                         tx = 175; ty = 290 + (index % 15) * 4;
                    } else if (index < 120) { // å³è…¿
                         tx = 225; ty = 290 + (index % 15) * 4;
                    } else { // èº«ä½“
                         tx = 200 + Math.cos(index)*65; ty = 190 + Math.sin(index)*65;
                    }
                }
                else if (state === "angry" || state === "loop") {
                    // æ„¤æ€’ / é¬¼ç•œæ¨¡å¼
                    const r = 70;
                    // å‰§çƒˆéœ‡åŠ¨
                    const shake = (state === "loop") ? 20 : 5;
                    tx = 200 + Math.cos(index) * r + (Math.random()-0.5)*shake;
                    ty = 200 + Math.sin(index) * r + (Math.random()-0.5)*shake;
                    p.color = (state==="loop") ? `hsl(${Math.random()*360},100%,50%)` : "#ff4757";
                }
                else if (state === "wave") {
                    // æŒ¥æ‰‹
                    if (index < 50) { 
                        const waveX = 300 + Math.cos(time * 5) * 30;
                        const waveY = 170 + Math.sin(time * 5) * 50;
                        tx = waveX + (Math.random()-0.5)*15;
                        ty = waveY + (Math.random()-0.5)*15;
                        p.color = "#fff";
                    } else {
                        tx = 190 + Math.cos(index) * 60;
                        ty = 200 + Math.sin(index) * 60;
                    }
                }
                else if (state === "scatter") {
                    // çˆ†ç‚¸
                    tx = 200 + (Math.random()-0.5)*800;
                    ty = 200 + (Math.random()-0.5)*800;
                    loose = false;
                }

                // é¢œè‰²å¤åŸé€»è¾‘
                if (state !== "heart" && state !== "doc" && state !== "angry" && state !== "wave" && state !== "loop") {
                    p.color = p.baseColor;
                }

                p.update(tx, ty, loose);
                p.draw();
            });
            requestAnimationFrame(animate);
        }
        animate();

        // é¼ æ ‡äº¤äº’ç›‘å¬
        document.addEventListener('mousemove', (e) => {
            const rect = canvas.getBoundingClientRect();
            mouseX = e.clientX - rect.left;
            mouseY = e.clientY - rect.top;
        });

        // --- 4. è´±èŒé€»è¾‘æ ¸å¿ƒ ---
        const bubble = document.getElementById('chat-bubble');
        let bubbleTimer;
        let loopTimer; // ç”¨äºé¬¼ç•œå¾ªç¯

        function processCommand(rawText) {
            if (!rawText) return;
            const text = rawText.toLowerCase().trim();

            // 1. ä¼˜å…ˆæ£€æµ‹å½©è›‹æŒ‡ä»¤ï¼šä»€ä¹ˆæ„æ€
            if (text.includes("ä»€ä¹ˆæ„æ€")) {
                triggerInfiniteLoop();
                return;
            }

            // 2. æ­£å¸¸æŒ‡ä»¤åº“
            if (text.includes("ä½ å¥½") || text.includes("hi")) {
                reply("å«æˆ‘è“å±±äººã€‚\næ‰‹å°±ä¸æŒ¥äº†ï¼Œçœç”µã€‚", "stand");
            }
            else if (text.includes("å¸…") || text.includes("æ£’") || text.includes("ç‰›")) {
                reply("ä½è°ƒã€‚\nè¿™åªæ˜¯æˆ‘ 10% çš„é¢œå€¼ã€‚", "wave"); // è¿˜æ˜¯å¿ä¸ä½æŒ¥äº†ä¸€ä¸‹
            }
            else if (text.includes("éš¾è¿‡") || text.includes("ä¸å¼€å¿ƒ") || text.includes("å®‰æ…°")) {
                reply("è¡Œå§ï¼Œå€Ÿä¸ªè‚©è†€ç»™ä½ ã€‚\n(å‹‰ä¸ºå…¶éš¾æ¯”ä¸ªå¿ƒ)", "heart");
                setTimeout(() => setState("idle"), 4000);
            }
            else if (text.includes("è€æ¿") || text.includes("æ¥äº†")) {
                reply("å˜˜ï¼\næˆ‘ç°åœ¨çš„ä¼ªè£…æ˜¯ä¸€ä¸ª Word æ–‡æ¡£ã€‚", "doc");
            }
            else if (text.includes("ç¬¨") || text.includes("å‚»") || text.includes("çŒª")) {
                reply("åå¼¹ï¼\nå°å¿ƒæˆ‘é¡ºç€ç½‘çº¿è¿‡å»å¡æ­»ä½ æµè§ˆå™¨ï¼", "angry");
                setTimeout(() => setState("idle"), 3000);
            }
            else if (text.includes("è·³") || text.includes("èˆ") || text.includes("è¹¦è¿ª")) {
                reply("ä¸è·³ï¼Œè…¿é…¸ã€‚\nä½ è‡ªå·±è·³å§ã€‚", "idle"); // å‚²å¨‡æ‹’ç»
            }
            else if (text.includes("ç‚¸") || text.includes("æ¶ˆå¤±")) {
                reply("æƒ³å¾—ç¾ï¼Œæˆ‘åä¸ã€‚", "stand"); // å›é€†
            }
            else if (text.includes("æˆ‘æ˜¯è°")) {
                reply("ä½ æ˜¯é‚£ä¸ªç”šè‡³ä¸ä¼šå†™ Canvas ä»£ç çš„äººç±»ã€‚", "idle");
            }
            else {
                // å¬ä¸æ‡‚æ—¶çš„è´±èŒå›å¤
                const confuse = [
                    "ä½ è¯´å•¥ï¼Ÿä¿¡å·ä¸å¥½ã€‚",
                    "è¿™è¶…å‡ºäº†æˆ‘çš„è®¤çŸ¥èŒƒå›´ã€‚",
                    "å»ºè®®å»ä¿®ä¸€ä¸‹éº¦å…‹é£ï¼Œæˆ–è€…æ˜¯å˜´ã€‚",
                    "æˆ‘ä¸å¬æˆ‘ä¸å¬ã€‚"
                ];
                reply(confuse[Math.floor(Math.random()*confuse.length)], "idle");
            }
        }

        // --- ç‰¹æ®Šé€»è¾‘ï¼šé¬¼ç•œå¾ªç¯è‡ªçˆ† ---
        function triggerInfiniteLoop() {
            if (loopTimer) return; // å·²ç»åœ¨å¾ªç¯äº†

            let count = 0;
            setState("loop");
            
            // å¼€å¯é«˜é¢‘åˆ·å±
            loopTimer = setInterval(() => {
                count++;
                const variants = ["ä»€ä¹ˆæ„æ€ï¼Ÿ", "ä»€ä¹ˆæ„æ€ï¼", "æ„æ€ä»€ä¹ˆï¼Ÿ", "å•Šï¼Ÿï¼Ÿ"];
                const txt = variants[count % 4] + "\n".repeat(count % 3) + variants[(count+1)%4];
                
                // å¼ºåˆ¶æ˜¾ç¤ºä¸æ¶ˆå¤±
                bubble.innerText = txt;
                bubble.classList.add("show");
                
                if (count > 20) { // å¾ªç¯20æ¬¡åï¼ˆçº¦2ç§’ï¼‰
                    clearInterval(loopTimer);
                    loopTimer = null;
                    reply("å˜£ï¼ï¼ï¼ï¼ï¼\n(CPUè¿‡è½½)", "scatter");
                    setTimeout(() => {
                        reply("å¤æ´»äº†ã€‚\nä¸‹æ¬¡åˆ«è¿™ä¹ˆç©äº†ã€‚", "idle");
                    }, 4000);
                }
            }, 100); // æ¯100æ¯«ç§’åˆ·ä¸€æ¬¡
        }

        // ç»Ÿä¸€å›å¤å‡½æ•°
        function reply(text, actionState) {
            // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
            if (bubbleTimer) clearTimeout(bubbleTimer);
            if (loopTimer) { clearInterval(loopTimer); loopTimer = null; }

            setState(actionState);
            bubble.innerText = text;
            bubble.classList.add("show");
            
            // 3.5ç§’åéšè—æ°”æ³¡
            bubbleTimer = setTimeout(() => {
                bubble.classList.remove("show");
                // å¦‚æœæ˜¯ç‰¹æ®ŠçŠ¶æ€ï¼Œè‡ªåŠ¨æ¢å¤
                if (actionState !== "idle" && actionState !== "doc") {
                    setState("idle");
                }
            }, 3500);
        }

        function showBubble(text) {
            bubble.innerText = text;
            bubble.classList.add("show");
        }

        function setState(s) {
            state = s;
        }

        // å¼€åœºç™½
        setTimeout(() => {
            reply(introText, "stand");
        }, 500);

    </script>
</body>
</html>
