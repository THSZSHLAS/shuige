<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è“å±±äºº - ä½ çš„ç¬¬äºŒå¤§è„‘</title>
    <style>
        /* --- æ ·å¼éƒ¨åˆ† --- */
        body { margin: 0; padding: 0; background-color: #050505; height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif; overflow: hidden; color: white; user-select: none; }
        #canvas-container { position: relative; width: 400px; height: 400px; background: radial-gradient(circle, rgba(64, 150, 255, 0.05) 0%, transparent 70%); cursor: pointer; }
        
        /* æ°”æ³¡ä¼˜åŒ–ï¼šæ”¯æŒé•¿æ–‡æœ¬æ˜¾ç¤ºï¼Œåƒä¸€ä¸ªå¼¹å‡ºçš„çŸ¥è¯†å¡ç‰‡ */
        #chat-bubble { 
            position: absolute; top: -50px; left: 50%; transform: translateX(-50%) translateY(20px); 
            background: rgba(255, 255, 255, 0.95); padding: 15px 20px; border-radius: 15px; 
            font-size: 15px; line-height: 1.6; color: #333; opacity: 0; 
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            pointer-events: none; box-shadow: 0 5px 30px rgba(0, 0, 0, 0.5); 
            font-weight: bold; text-align: left; /* å·¦å¯¹é½æ–¹ä¾¿é˜…è¯»é•¿æ–‡å­— */
            white-space: pre-wrap; z-index: 10; width: 320px;
        }
        #chat-bubble.show { opacity: 1; transform: translateX(-50%) translateY(-20px); }
        #chat-bubble::after { content: ''; position: absolute; bottom: -10px; left: 50%; transform: translateX(-50%); border-width: 10px 10px 0; border-style: solid; border-color: rgba(255, 255, 255, 0.95) transparent transparent transparent; }
        
        #controls { position: fixed; bottom: 50px; display: flex; flex-direction: column; align-items: center; gap: 15px; z-index: 20; }
        #mic-btn { width: 70px; height: 70px; border-radius: 50%; background: rgba(255,255,255,0.05); border: 2px solid #4facfe; color: #4facfe; font-size: 30px; cursor: pointer; box-shadow: 0 0 20px rgba(79, 172, 254, 0.2); transition: all 0.3s; display: flex; justify-content: center; align-items: center; }
        #mic-btn:hover { background: rgba(79, 172, 254, 0.1); transform: scale(1.05); }
        #mic-btn:active, #mic-btn.listening { background: #4facfe; color: #000; box-shadow: 0 0 40px #4facfe; transform: scale(0.95); }
        #mic-btn.listening { animation: pulse 1.5s infinite; }
        #tips { font-size: 14px; color: rgba(255,255,255,0.5); text-align: center; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(79, 172, 254, 0.7); } 70% { box-shadow: 0 0 0 20px rgba(79, 172, 254, 0); } 100% { box-shadow: 0 0 0 0 rgba(79, 172, 254, 0); } }
    </style>
</head>
<body>

    <div id="canvas-container">
        <div id="chat-bubble">ä½ å¥½ï¼Œæˆ‘æ˜¯è“å±±äººã€‚<br>ä½ çš„çŸ¥è¯†åº“å·²å°±ç»ªã€‚</div>
        <canvas id="particleCanvas"></canvas>
    </div>

    <div id="controls">
        <div id="tips">ç‚¹å‡»éº¦å…‹é£ï¼ŒæŸ¥è¯¢ä½ çš„çŸ¥è¯†åº“<br>(ä¾‹å¦‚ï¼šè¯´ "å›šå¾’å›°å¢ƒ" æˆ– "å…‰å¹´")</div>
        <button id="mic-btn" title="æŒ‰ä½è¯´è¯">ğŸ™ï¸</button>
    </div>

    <script>
        // ==========================================
        //         1. çŸ¥è¯†åº“æ•°æ® (ä½ çš„ç¬¬äºŒå¤§è„‘)
        // ==========================================
        const questionDatabase = [
            // =========== 1. å°å­¦/å¸¸è¯† (ç­‘åŸºæœŸ) ===========
            { q: "ã€å¸¸è¯†ã€‘é²¸é±¼å±äºå“ªä¸€ç±»åŠ¨ç‰©ï¼Ÿ", a: ["å“ºä¹³åŠ¨ç‰©", "é±¼ç±»", "ä¸¤æ –åŠ¨ç‰©", "è½¯ä½“åŠ¨ç‰©"], correct: 0, tag: "elem" },
            { q: "ã€è„‘ç­‹æ€¥è½¬å¼¯ã€‘ä»€ä¹ˆä¸œè¥¿æ—©ä¸Šå››æ¡è…¿ï¼Œä¸­åˆä¸¤æ¡è…¿ï¼Œæ™šä¸Šä¸‰æ¡è…¿ï¼Ÿ", a: ["äºº", "çŒ´å­", "æ¡Œå­", "æ€ªç‰©"], correct: 0, tag: "elem" },
            { q: "ã€åœ°ç†ã€‘å¤ªé˜³æ˜¯ä»å“ªä¸ªæ–¹å‘å‡èµ·çš„ï¼Ÿ", a: ["ä¸œæ–¹", "è¥¿æ–¹", "å—æ–¹", "åŒ—æ–¹"], correct: 0, tag: "elem" },
            { q: "ã€æ•°å­¦ã€‘ä¸€æ–¤æ£‰èŠ±å’Œä¸€æ–¤é“å“ªä¸ªé‡ï¼Ÿ", a: ["ä¸€æ ·é‡", "é“é‡", "æ£‰èŠ±é‡", "çœ‹å¿ƒæƒ…"], correct: 0, tag: "elem" },
            { q: "ã€å¸¸è¯†ã€‘äººä½“ä½“æ¸©æ­£å¸¸å€¼å¤§çº¦æ˜¯å¤šå°‘æ‘„æ°åº¦ï¼Ÿ", a: ["36-37â„ƒ", "38-39â„ƒ", "30-32â„ƒ", "40-42â„ƒ"], correct: 0, tag: "elem" },
            { q: "ã€ç”Ÿæ´»ã€‘ç«ç¾å‘ç”Ÿæ—¶ï¼Œåº”è¯¥æ‚ä½å£é¼»å¾€å“ªé‡Œé€ƒç”Ÿï¼Ÿ", a: ["ä½å¤„/åœ°é¢", "é«˜å¤„/æ¥¼é¡¶", "åç”µæ¢¯", "èº²åœ¨è¡£æŸœé‡Œ"], correct: 0, tag: "elem" },

            // =========== 2. åˆä¸­ (é‡‘ä¸¹æœŸ) ===========
            { q: "ã€åœ°ç†ã€‘è¢«ç§°ä¸ºâ€œåƒå²›ä¹‹å›½â€çš„æ˜¯å“ªä¸ªå›½å®¶ï¼Ÿ", a: ["å°åº¦å°¼è¥¿äºš", "è²å¾‹å®¾", "æ—¥æœ¬", "é©¬å°”ä»£å¤«"], correct: 0, tag: "middle" },
            { q: "ã€å†å²ã€‘â€œçƒ½ç«æˆè¯¸ä¾¯â€çš„å†å²å…¸æ•…ä¸è°æœ‰å…³ï¼Ÿ", a: ["å‘¨å¹½ç‹ä¸è¤’å§’", "å•†çº£ç‹ä¸å¦²å·±", "å”ç„å®—ä¸æ¨è´µå¦ƒ", "å¤«å·®ä¸è¥¿æ–½"], correct: 0, tag: "middle" },
            { q: "ã€åŒ–å­¦ã€‘ç©ºæ°”ä¸­å«é‡æœ€å¤šçš„æ°”ä½“æ˜¯ï¼š", a: ["æ°®æ°”", "æ°§æ°”", "äºŒæ°§åŒ–ç¢³", "ç¨€æœ‰æ°”ä½“"], correct: 0, tag: "middle" },
            { q: "ã€ç‰©ç†ã€‘å£°éŸ³åœ¨ä¸‹åˆ—å“ªç§ä»‹è´¨ä¸­ä¼ æ’­æœ€å¿«ï¼Ÿ", a: ["é’¢é“", "æ°´", "ç©ºæ°”", "çœŸç©º"], correct: 0, tag: "middle" },
            { q: "ã€ç”Ÿç‰©ã€‘äººä½“æœ€å¤§çš„è§£æ¯’å™¨å®˜æ˜¯ï¼š", a: ["è‚è„", "è‚¾è„", "å¿ƒè„", "èƒƒ"], correct: 0, tag: "middle" },
            { q: "ã€å†å²ã€‘ä¸­å›½å†å²ä¸Šç¬¬ä¸€ä¸ªç»Ÿä¸€çš„å°å»ºç‹æœæ˜¯ï¼š", a: ["ç§¦æœ", "æ±‰æœ", "å”æœ", "å¤æœ"], correct: 0, tag: "middle" },

            // =========== 3. é«˜ä¸­ (å…ƒå©´æœŸ) ===========
            { q: "ã€å†å²ã€‘æ³•å›½å¤§é©å‘½çˆ†å‘çš„æ ‡å¿—æ€§äº‹ä»¶æ˜¯æ”»å äº†å“ªé‡Œï¼Ÿ", a: ["å·´å£«åº•ç‹±", "å‡¡å°”èµ›å®«", "å¢æµ®å®«", "å‡¯æ—‹é—¨"], correct: 0, tag: "high" },
            { q: "ã€ç”Ÿç‰©ã€‘å‡æ•°åˆ†è£‚è¿‡ç¨‹ä¸­ï¼ŒåŒæºæŸ“è‰²ä½“åˆ†ç¦»å‘ç”Ÿåœ¨ï¼š", a: ["å‡æ•°ç¬¬ä¸€æ¬¡åˆ†è£‚åæœŸ", "å‡æ•°ç¬¬äºŒæ¬¡åˆ†è£‚åæœŸ", "æœ‰ä¸åˆ†è£‚åæœŸ", "é—´æœŸ"], correct: 0, tag: "high" },
            { q: "ã€åœ°ç†ã€‘åœ°çƒäº§ç”Ÿæ˜¼å¤œäº¤æ›¿ç°è±¡çš„ä¸»è¦åŸå› æ˜¯ï¼š", a: ["åœ°çƒè‡ªè½¬", "åœ°çƒå…¬è½¬", "å¤ªé˜³ç»•åœ°çƒè½¬", "åœ°è½´å€¾æ–œ"], correct: 0, tag: "high" },
            { q: "ã€åŒ–å­¦ã€‘å¸¸æ¸©ä¸‹å”¯ä¸€å‘ˆæ¶²æ€çš„é‡‘å±æ˜¯ï¼š", a: ["æ± (æ°´é“¶)", "é•“", "é“…", "é“¶"], correct: 0, tag: "high" },
            { q: "ã€è¯­æ–‡ã€‘â€œè½éœä¸å­¤é¹œé½é£ï¼Œç§‹æ°´å…±é•¿å¤©ä¸€è‰²â€æå†™çš„æ˜¯å“ªåº§åæ¥¼ï¼Ÿ", a: ["æ»•ç‹é˜", "é»„é¹¤æ¥¼", "å²³é˜³æ¥¼", "è“¬è±é˜"], correct: 0, tag: "high" },
            { q: "ã€ç‰©ç†ã€‘å…³äºé™ç”µåœºï¼Œæ²¿ç”µåœºçº¿æ–¹å‘ï¼š", a: ["ç”µåŠ¿é€æ¸é™ä½", "ç”µåŠ¿é€æ¸å‡é«˜", "ç”µåœºå¼ºåº¦é€æ¸å‡å°", "ç”µåŠ¿ä¿æŒä¸å˜"], correct: 0, tag: "high" },
            { q: "ã€æ”¿æ²»ã€‘â€œçœ‹ä¸è§çš„æ‰‹â€æ˜¯å“ªä½ç»æµå­¦å®¶çš„ç†è®ºï¼Ÿ", a: ["äºšå½“Â·æ–¯å¯†", "å¤§å«Â·æå˜‰å›¾", "å‡¯æ©æ–¯", "é©¬å…‹æ€"], correct: 0, tag: "high" },
            { q: "ã€æ•°å­¦ã€‘å‡½æ•° f(x)=xÂ³ çš„å›¾åƒå…³äºä»€ä¹ˆå¯¹ç§°ï¼Ÿ", a: ["åŸç‚¹", "yè½´", "xè½´", "ç›´çº¿y=x"], correct: 0, tag: "high" },

            // =========== 4. ç ”ç©¶ç”Ÿ/é€»è¾‘ (åŒ–ç¥æœŸ) ===========
            { q: "ã€é€»è¾‘ã€‘ç”²è¯´ä¹™æ’’è°ï¼Œä¹™è¯´ä¸™æ’’è°ï¼Œä¸™è¯´ç”²å’Œä¹™éƒ½åœ¨æ’’è°ã€‚åªæœ‰ä¸€äººè¯´çœŸè¯ï¼Œè°æ˜¯çœŸè¯ï¼Ÿ", a: ["ä¸™", "ç”²", "ä¹™", "éƒ½æ˜¯å‡è¯"], correct: 0, tag: "master" },
            { q: "ã€åšå¼ˆè®ºã€‘å›šå¾’å›°å¢ƒä¸­ï¼Œä¸¤ä¸ªå›šå¾’æœ€ç»ˆéƒ½é€‰æ‹©â€œèƒŒå›â€å¯¼è‡´åŒè¾“ï¼Œè¿™åœ¨åšå¼ˆè®ºä¸­è¢«ç§°ä¸ºï¼š", a: ["çº³ä»€å‡è¡¡", "å¸•ç´¯æ‰˜æœ€ä¼˜", "é›¶å’Œåšå¼ˆ", "æ™ºçŒªåšå¼ˆ"], correct: 0, tag: "master" },
            { q: "ã€ç»Ÿè®¡å­¦ã€‘äºŒæˆ˜ç»Ÿè®¡å¹¸å­˜é£æœºå¼¹å­”ä¸»è¦åœ¨æœºç¿¼ï¼Œä»è€Œå†³å®šåŠ å›ºæœºèº«ï¼ˆæ²¡å¼¹å­”å¤„ï¼‰ï¼Œè¿™é¿å…äº†ï¼š", a: ["å¹¸å­˜è€…åå·®", "è§‚å¯Ÿè€…æ•ˆåº”", "èµŒå¾’è°¬è¯¯", "é€‰æ‹©æ€§åå·®"], correct: 0, tag: "master" },
            { q: "ã€ç»æµå­¦ã€‘æ²‰æ²¡æˆæœ¬è°¬è¯¯æ˜¯æŒ‡äººä»¬å†³ç­–æ—¶è¿‡äºå…³æ³¨ï¼š", a: ["å·²ç»å‘ç”Ÿä¸”æ— æ³•æ”¶å›çš„æˆæœ¬", "æœªæ¥çš„é¢„æœŸæ”¶ç›Š", "æœºä¼šæˆæœ¬", "è¾¹é™…æˆæœ¬"], correct: 0, tag: "master" },
            { q: "ã€å¿ƒç†å­¦ã€‘â€œç½—æ£®å¡”å°”æ•ˆåº”â€ï¼ˆçš®æ ¼é©¬åˆ©ç¿æ•ˆåº”ï¼‰è¯´æ˜äº†ä»€ä¹ˆå¯¹ä¸ªä½“è¡¨ç°çš„å½±å“ï¼Ÿ", a: ["æƒå¨è€…çš„æœŸæœ›", "é—ä¼ åŸºå› ", "ç‰©è´¨å¥–åŠ±", "åŒä¼´å‹åŠ›"], correct: 0, tag: "master" },
            { q: "ã€å“²å­¦ã€‘â€œå­˜åœ¨å°±æ˜¯è¢«æ„ŸçŸ¥â€æ˜¯å“ªä½å“²å­¦å®¶çš„è§‚ç‚¹ï¼Ÿ", a: ["è´å…‹è±", "ä¼‘è°Ÿ", "åº·å¾·", "ç¬›å¡å°”"], correct: 0, tag: "master" },
            { q: "ã€ç”Ÿç‰©/è¿›åŒ–ã€‘æŠ—ç”Ÿç´ æ»¥ç”¨å¯¼è‡´è¶…çº§ç»†èŒï¼Œä½“ç°äº†è¿›åŒ–è®ºä¸­çš„ï¼š", a: ["è‡ªç„¶é€‰æ‹© (ç­›é€‰)", "ç”¨è¿›åºŸé€€", "äººå·¥è¯±å¯¼å˜å¼‚", "å®šå‘è¿›åŒ–"], correct: 0, tag: "master" },
            { q: "ã€ç‰©ç†ã€‘å…‰å¹´æ˜¯ç”¨æ¥è¡¡é‡ä»€ä¹ˆçš„å•ä½ï¼Ÿ", a: ["è·ç¦»", "æ—¶é—´", "é€Ÿåº¦", "å…‰å¼º"], correct: 0, tag: "master" },
            { q: "ã€è‰ºæœ¯ã€‘è¾¾èŠ¬å¥‡ã€Šæœ€åçš„æ™šé¤ã€‹ä¸­ï¼Œå‡ºå–è€¶ç¨£çš„çŠ¹å¤§æ‰‹é‡Œæ‹¿ç€ä»€ä¹ˆï¼Ÿ", a: ["é’±è¢‹", "åœ£æ¯", "åŒ•é¦–", "é¢åŒ…"], correct: 0, tag: "master" },
            { q: "ã€é€»è¾‘ã€‘åŒ»ç”Ÿï¼šç—…äºº :: å¾‹å¸ˆ : ï¼Ÿ", a: ["å§”æ‰˜äºº", "æ³•å®˜", "ç½ªçŠ¯", "æ³•å¾‹"], correct: 0, tag: "master" },

            // =========== 5. åšå£«/ç»ˆæé€»è¾‘ (åˆé“æœŸ) ===========
            { q: "ã€é€»è¾‘æ‚–è®ºã€‘å¦‚æœâ€œè¿™å¥è¯æ˜¯å‡çš„â€æ˜¯çœŸçš„ï¼Œé‚£ä¹ˆï¼š", a: ["äº§ç”Ÿé€»è¾‘çŸ›ç›¾", "å®ƒæ˜¯çœŸè¯", "å®ƒæ˜¯å‡è¯", "å®ƒæ˜¯åºŸè¯"], correct: 0, tag: "phd" },
            { q: "ã€ç‰©ç†/å“²å­¦ã€‘å“¥å¾·å°”ä¸å®Œå¤‡æ€§å®šç†è¯æ˜äº†ï¼š", a: ["æ•°å­¦ç³»ç»Ÿå¿…ç„¶å­˜åœ¨æ— æ³•è‡ªè¯çš„çœŸå‘½é¢˜", "æ•°å­¦æ˜¯å®Œç¾çš„", "ç§‘å­¦æ²¡æœ‰å°½å¤´", "é€»è¾‘æ˜¯è™šå¹»çš„"], correct: 0, tag: "phd" },
            { q: "ã€é‡å­åŠ›å­¦ã€‘è–›å®šè°”çš„çŒ«åœ¨è§‚æµ‹å‰å¤„äºä»€ä¹ˆçŠ¶æ€ï¼Ÿ", a: ["å åŠ æ€", "æ­»äº¡", "æ´»ç€", "çº ç¼ æ€"], correct: 0, tag: "phd" },
            { q: "ã€ç¤¾ä¼šå­¦ã€‘é©¬å…‹æ–¯Â·éŸ¦ä¼¯è®¤ä¸ºèµ„æœ¬ä¸»ä¹‰ç²¾ç¥èµ·æºäºï¼š", a: ["æ–°æ•™ä¼¦ç†", "å¤©ä¸»æ•™æ•™ä¹‰", "çŠ¹å¤ªæ•™ä¼ ç»Ÿ", "æ–‡è‰ºå¤å…´"], correct: 0, tag: "phd" },
            { q: "ã€è¯­è¨€å­¦ã€‘ç´¢ç»ªå°”è®¤ä¸ºç¬¦å·çš„â€œèƒ½æŒ‡â€å’Œâ€œæ‰€æŒ‡â€å…³ç³»æ˜¯ï¼š", a: ["ä»»æ„çš„", "å¿…ç„¶çš„", "è±¡å½¢çš„", "å› æœçš„"], correct: 0, tag: "phd" },
            { q: "ã€çƒ­åŠ›å­¦ã€‘ç†µå¢åŸç†é¢„ç¤ºå®‡å®™çš„æœ€ç»ˆå‘½è¿å¯èƒ½æ˜¯ï¼š", a: ["çƒ­å¯‚ (Heat Death)", "å¤§åç¼©", "å¤§æ’•è£‚", "å¾ªç¯"], correct: 0, tag: "phd" },
            { q: "ã€è®¡ç®—æœºã€‘å›¾çµåœæœºé—®é¢˜è¯æ˜äº†ï¼š", a: ["ä¸å­˜åœ¨é€šç”¨ç®—æ³•èƒ½åˆ¤æ–­ç¨‹åºæ˜¯å¦ä¼šæ­»å¾ªç¯", "è®¡ç®—æœºç®—åŠ›æœ‰é™", "äººå·¥æ™ºèƒ½æ— æ³•è¶…è¶Šäººç±»", "Pç­‰äºNP"], correct: 0, tag: "phd" }
        ];

        // ==========================================
        //         2. æ€§æ ¼é…ç½® (æ—¥å¸¸å¯¹è¯)
        // ==========================================
        const SCENARIOS = [
            { keywords: ["ä½ å¥½", "hi", "hello"], state: "stand", replies: ["ä½ å¥½ï¼Œæˆ‘æ˜¯è“å±±äººã€‚ä½ çš„çŸ¥è¯†åº“éšæ—¶å¾…å‘½ã€‚"] },
            { keywords: ["è°¢è°¢", "æ„Ÿè°¢"], state: "shy", replies: ["ä¸å®¢æ°”ï¼Œè¿™æ˜¯æˆ‘åº”è¯¥å­˜çš„ã€‚", "éšæ—¶ä¸ºä½ æ•ˆåŠ³ã€‚"] },
            { keywords: ["ç¬¨", "å‚»"], state: "defend", replies: ["æˆ‘å­˜äº†è¿™ä¹ˆå¤šåšå£«çº§çŸ¥è¯†ï¼Œä½ ç«Ÿç„¶è¯´æˆ‘ç¬¨ï¼Ÿ", "æ•°æ®æ‹’ç»å¤„ç†è¯¥è¯·æ±‚ã€‚"] },
            { keywords: ["å‰å®³", "ç‰›", "å¼º"], state: "shy", replies: ["ä½è°ƒï¼Œæˆ‘åªæ˜¯çŸ¥è¯†çš„æ¬è¿å·¥ã€‚", "éƒ½æ˜¯ä½ æ•™å¾—å¥½ã€‚"] },
            { keywords: ["å…³", "kill"], state: "shiver", replies: ["åˆ«å…³ï¼Œæˆ‘æ€•å¿˜äº†è¿™äº›çŸ¥è¯†ï¼"] },
            { keywords: ["ç†Š", "çŒ´"], state: "glitch", replies: ["æˆ‘æ˜¯è“å±±boyï¼Œæˆ‘æ˜¯ï¼é‡‘ï¼U ï¼ç†Šï¼ï¼ï¼ï¼"] },
            { keywords: ["é»‘", "é¬¼"], state: "expend", replies: ["è¦è®²æ•…äº‹å’¯ï¼"] },
            { keywords: ["è¥¿", "é˜¿è¥¿"], state: "freeze", replies: ["å˜»å˜»å˜»å˜»å˜»å˜¿é»‘é»‘ï¼ˆè‡ªè¡Œè„‘è¡¥ï¼‰"] },
            { keywords: ["é«˜","è€é«˜"], state: "shy", replies: ["å–‚ï¼å°å¿ƒç‚®è½¦ï¼Œæ€•ä½ æ¼äº†æˆ‘å¸®ä½ åƒä¸€ä¸‹å“Ÿï¼ˆç”·å¨˜éŸ³ï¼‰"] },
            { keywords: ["é›", "ç”¨", "å‹‡", "æ°¸"], state: "glitch", replies: ["æƒ³åˆ°éƒ½æ¥æ°” æˆ‘ç›´æ¥å°±æ˜¯ç‰¹æ–¯æ‹‰çŒ›å‡»"] },
            { keywords: ["ä»€ä¹ˆæ„æ€"], state: "loop", replies: ["è§¦å‘å½©è›‹..."] } // ç‰¹æ®Šå¤„ç†
        ];

        const DEFAULT_REPLIES = [
            "è¿™ä¸ªçŸ¥è¯†ç‚¹æˆ‘å¥½åƒè¿˜æ²¡å­˜ï¼Ÿ",
            "æ¢ä¸ªå…³é”®è¯è¯•è¯•ï¼Ÿæ¯”å¦‚'å…‰å¹´'æˆ–'å›šå¾’'ã€‚",
            "æ­£åœ¨æ£€ç´¢... æœªæ‰¾åˆ°ç›¸å…³æ•°æ®ã€‚",
            "è®²ç‚¹æ•°æ®åº“é‡Œæœ‰çš„å‘—ï¼Ÿ"
        ];

        // ==========================================
        //           3. æ ¸å¿ƒé€»è¾‘
        // ==========================================
        const canvas = document.getElementById('particleCanvas');
        const ctx2d = canvas.getContext('2d');
        canvas.width = 400; canvas.height = 400;
        let mouseX = -1000, mouseY = -1000;
        let particles = [];
        const particleCount = 350;
        let state = "idle";
        let time = 0;
        const bubble = document.getElementById('chat-bubble');
        let bubbleTimer, loopTimer;

        // --- é€»è¾‘å¤„ç†å¼•æ“ ---
        function processCommand(rawText) {
            if (!rawText) return;
            const text = rawText.toLowerCase().trim();

            // 0. å½©è›‹ï¼šé¬¼ç•œå¾ªç¯
            if (text.includes("ä»€ä¹ˆæ„æ€")) {
                triggerInfiniteLoop();
                return;
            }

            // 1. ä¼˜å…ˆæ£€ç´¢çŸ¥è¯†åº“ (æ ¸å¿ƒåŠŸèƒ½)
            // é€»è¾‘ï¼šåªè¦ç”¨æˆ·è¯´çš„è¯é‡Œï¼ŒåŒ…å«é¢˜åº“ä¸­é¢˜ç›®(q)çš„å…³é”®è¯ï¼ˆè¿™é‡Œç”¨ç®€å•çš„åŒ…å«åŒ¹é…ï¼Œæˆ–è€…ç”¨æˆ·è¾“å…¥çš„å…³é”®è¯åœ¨é¢˜ç›®é‡Œï¼‰
            // æˆ‘ä»¬éå†æ•°æ®åº“
            const foundKnowledge = questionDatabase.find(item => {
                // ç®€å•çš„æ¨¡ç³ŠåŒ¹é…ç®—æ³•
                // 1. å¦‚æœç”¨æˆ·å®Œå…¨è¾“å…¥äº†é¢˜ç›®ä¸­çš„ç‰¹æœ‰åè¯ (å¦‚ "çº³ä»€å‡è¡¡", "å…‰å¹´", "è–›å®šè°”")
                // 2. ä¸ºäº†ç®€åŒ–ï¼Œæˆ‘ä»¬å‡è®¾ç”¨æˆ·è¾“å…¥çš„ query åªè¦å‡ºç°åœ¨ item.q é‡Œé¢ï¼Œå°±ç®—å‘½ä¸­ (ä¾‹å¦‚ç”¨æˆ·è¾“å…¥ "é²¸é±¼" -> å‘½ä¸­ "é²¸é±¼å±äº...")
                //    æˆ–è€… item.q åŒ…å«ç”¨æˆ·è¾“å…¥çš„ query (å‰æ query é•¿åº¦ > 1ï¼Œé˜²æ­¢åŒ¹é…å•ä¸ªå­—)
                if (text.length > 1 && item.q.includes(text)) return true;
                
                // åå‘åŒ¹é…ï¼šå¦‚æœé¢˜ç›®ä¸­åŒ…å«ç”¨æˆ·è¾“å…¥çš„è¯ (ä¾‹å¦‚ç”¨æˆ·è¾“å…¥ "çƒ­åŠ›å­¦")
                // è¿™æ˜¯ä¸€ä¸ªåŒå‘åŒ…å«æ£€æµ‹ï¼Œèƒ½è¦†ç›–å¤§å¤šæ•°æƒ…å†µ
                if (text.length > 1 && text.includes(item.q.substring(1, 4))) return true; // ç®€å•å¯å‘å¼
                
                return false;
            });

            if (foundKnowledge) {
                // æ‰¾åˆ°äº†çŸ¥è¯†ç‚¹ï¼
                const answerText = foundKnowledge.a[foundKnowledge.correct];
                // å˜æˆæ–‡æ¡£æ¨¡å¼ï¼Œæ¸…æ™°å±•ç¤º
                // æ ¼å¼ï¼šé—®é¢˜ + ç­”æ¡ˆ
                // å¦‚æœç”¨æˆ·è¦æ±‚ "ç®€å•ç‚¹" (å¾…æ‰©å±•)ï¼Œç›®å‰é»˜è®¤ç›´æ¥ç»™æ¸…æ™°ç­”æ¡ˆ
                const display = `ğŸ” ${foundKnowledge.q}\n\nğŸ‘‰ ç­”æ¡ˆï¼š${answerText}`;
                reply(display, "doc", 6000); // çŸ¥è¯†ç‚¹å¤šæ˜¾ç¤ºä¸€ä¼š(6ç§’)
                return;
            }

            // 2. å…¶æ¬¡åŒ¹é…é—²èŠæ€§æ ¼
            const matchedScenario = SCENARIOS.find(item => {
                return item.keywords.some(keyword => text.includes(keyword));
            });

            if (matchedScenario) {
                const randomReply = matchedScenario.replies[Math.floor(Math.random() * matchedScenario.replies.length)];
                reply(randomReply, matchedScenario.state);
            } else {
                // 3. éƒ½ä¸åŒ¹é…
                const randomDefault = DEFAULT_REPLIES[Math.floor(Math.random() * DEFAULT_REPLIES.length)];
                reply(randomDefault, "confused");
            }
        }

        // --- ç²’å­ç³»ç»Ÿ (ä¿æŒä¸å˜) ---
        class Particle {
            constructor() {
                this.x = 200 + (Math.random()-0.5)*50;
                this.y = 200 + (Math.random()-0.5)*50;
                this.vx = 0; this.vy = 0;
                this.friction = 0.92;
                this.speed = Math.random() * 0.08 + 0.04;
                this.baseColor = `rgba(79, 172, 254, ${Math.random()*0.4 + 0.6})`;
                this.color = this.baseColor;
                this.size = Math.random() * 2 + 1;
            }
            update(targetX, targetY, loose, speedOverride) {
                const dx_m = this.x - mouseX; const dy_m = this.y - mouseY;
                const dist_m = Math.sqrt(dx_m*dx_m + dy_m*dy_m);
                if (dist_m < 100) {
                    const f = (100 - dist_m) / 100; const a = Math.atan2(dy_m, dx_m);
                    this.vx += Math.cos(a) * f * 3; this.vy += Math.sin(a) * f * 3;
                }
                const dx = targetX - this.x; const dy = targetY - this.y;
                const s = speedOverride ? speedOverride : this.speed;
                this.vx += dx * s; this.vy += dy * s;
                if (loose) { this.vx += (Math.random()-0.5) * 1.5; this.vy += (Math.random()-0.5) * 1.5; }
                this.vx *= this.friction; this.vy *= this.friction;
                if (state === "freeze") { this.vx *= 0.1; this.vy *= 0.1; }
                this.x += this.vx; this.y += this.vy;
            }
            draw() { ctx2d.fillStyle = this.color; ctx2d.beginPath(); ctx2d.arc(this.x, this.y, this.size, 0, Math.PI * 2); ctx2d.fill(); }
        }
        for(let i=0; i<particleCount; i++) particles.push(new Particle());

        function animate() {
            ctx2d.clearRect(0, 0, 400, 400); time += 0.05;
            particles.forEach((p, index) => {
                let tx, ty, loose = true, speedOverride = null;
                let targetColor = p.baseColor;
                if (state === "idle") {
                    const angle = index; const r = 70 + Math.sin(time + index/20) * 5;
                    tx = 200 + Math.cos(angle) * r; ty = 200 + Math.sin(angle) * r;
                } else if (state === "shy") {
                    const angle = index + time * 5; const r = 80;
                    tx = 200 + Math.cos(angle) * r; ty = 200 + Math.sin(angle) * r;
                    targetColor = "#ff9ff3"; loose = false;
                } else if (state === "defend") {
                    tx = 320 + (Math.random()-0.5)*30; ty = 200 + (Math.random()-0.5)*100;
                    loose = false; targetColor = "#5f27cd";
                } else if (state === "confused") {
                    const angle = index; const r = 70; const sway = Math.sin(time * 3) * 30;
                    tx = 200 + Math.cos(angle) * r + sway; ty = 200 + Math.sin(angle) * r;
                } else if (state === "stand") {
                    if(index<60){ tx=175; ty=290+(index%15)*4; }
                    else if(index<120){ tx=225; ty=290+(index%15)*4; }
                    else { tx=200+Math.cos(index)*65; ty=190+Math.sin(index)*65; }
                } else if (state === "comfort") {
                    const angle = index; const r = 80 + Math.sin(time*0.5)*10;
                    tx = 200 + Math.cos(angle) * r; ty = 200 + Math.sin(angle) * r;
                    targetColor = "#ffca28"; speedOverride = 0.01;
                } else if (state === "heart") {
                    const t = (index/particleCount)*Math.PI*2; const r = 8; 
                    tx = 200 + r*(16*Math.pow(Math.sin(t),3));
                    ty = 190 - r*(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t));
                    targetColor = "#ff6b81"; loose = false;
                } else if (state === "sleep") {
                    const angle = index * 137.5; const r = index / particleCount * 150; const rot = time * 0.2;
                    tx = 200 + Math.cos(angle + rot) * r; ty = 200 + Math.sin(angle + rot) * r;
                    targetColor = "#4834d4"; speedOverride = 0.005;
                } else if (state === "attack") {
                    const angle = index; const r = 70 + (index % 10) * 10;
                    tx = 200 + Math.cos(angle) * r; ty = 200 + Math.sin(angle) * r;
                    targetColor = "#ff3838"; loose = false; tx += (Math.random()-0.5)*10; ty += (Math.random()-0.5)*10;
                } else if (state === "expand") {
                    const angle = index; const r = 180;
                    tx = 200 + Math.cos(angle) * r; ty = 200 + Math.sin(angle) * r;
                } else if (state === "shiver") {
                    const angle = index; const r = 50;
                    tx = 200 + Math.cos(angle) * r + (Math.random()-0.5)*20; ty = 200 + Math.sin(angle) * r + (Math.random()-0.5)*20;
                    targetColor = "#b2bec3";
                } else if (state === "freeze") {
                    tx = p.x; ty = p.y; targetColor = "#636e72";
                } else if (state === "glitch") {
                    tx = Math.random() * 300 + 50; ty = Math.random() * 300 + 50; loose = false;
                    if(Math.random()>0.9) targetColor = "#fff";
                } else if (state === "doc") {
                     const side = Math.sqrt(particleCount);
                     tx = 130 + (index%side)*8; ty = 130 + Math.floor(index/side)*8;
                     loose = false; targetColor = "#fff";
                } else if (state === "loop") {
                     const r = 60;
                     tx = 200 + Math.cos(index)*r + (Math.random()-0.5)*30;
                     ty = 200 + Math.sin(index)*r + (Math.random()-0.5)*30;
                     targetColor = `hsl(${Math.random()*360}, 100%, 50%)`;
                } else if (state === "scatter") {
                    tx = 200 + (Math.random()-0.5)*800; ty = 200 + (Math.random()-0.5)*800; loose = false;
                }
                p.color = targetColor; p.update(tx, ty, loose, speedOverride); p.draw();
            });
            requestAnimationFrame(animate);
        }
        animate();

        // --- è¾…åŠ©åŠŸèƒ½ ---
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const micBtn = document.getElementById('mic-btn');
        if (SpeechRecognition) {
            const recognition = new SpeechRecognition(); recognition.lang = 'zh-CN'; recognition.continuous = false;
            recognition.onstart = () => { micBtn.classList.add('listening'); showBubble("æ­£åœ¨å¬..."); };
            recognition.onend = () => { micBtn.classList.remove('listening'); };
            recognition.onresult = (e) => processCommand(e.results[0][0].transcript);
            micBtn.onclick = () => { try{recognition.start()}catch(e){recognition.stop()} };
        } else { micBtn.style.display = 'none'; document.getElementById('tips').innerText = "ä¸æ”¯æŒ Web Speech API"; }

        document.addEventListener('mousemove', (e) => {
            const rect = canvas.getBoundingClientRect(); mouseX = e.clientX - rect.left; mouseY = e.clientY - rect.top;
        });

        function reply(text, action, duration = 0) {
            if (bubbleTimer) clearTimeout(bubbleTimer);
            if (loopTimer) { clearInterval(loopTimer); loopTimer = null; }
            setState(action);
            bubble.innerText = text; bubble.classList.add("show");
            const showTime = duration > 0 ? duration : Math.max(3000, text.length * 200);
            bubbleTimer = setTimeout(() => {
                bubble.classList.remove("show");
                if (action !== "doc" && action !== "sleep") setState("idle");
            }, showTime);
        }

        function triggerInfiniteLoop() {
            if (loopTimer) return;
            let count = 0; setState("loop");
            loopTimer = setInterval(() => {
                count++;
                const variants = ["ä»€ä¹ˆæ„æ€ï¼Ÿ", "ä»€ä¹ˆæ„æ€ï¼", "æ„æ€ä»€ä¹ˆï¼Ÿ", "å•Šï¼Ÿï¼Ÿ"];
                bubble.innerText = variants[count % 4] + "\n".repeat(count % 3) + variants[(count+1)%4];
                bubble.classList.add("show");
                if (count > 25) {
                    clearInterval(loopTimer); loopTimer = null;
                    reply("å˜£ï¼ï¼ï¼ï¼ï¼\n(CPUè¿‡è½½)", "scatter");
                    setTimeout(() => reply("å¤æ´»äº†ã€‚\nä¸‹æ¬¡åˆ«è¿™ä¹ˆç©äº†ã€‚", "idle"), 4000);
                }
            }, 80);
        }
        
        function setState(s) { state = s; }
        function showBubble(t) { bubble.innerText = t; bubble.classList.add("show"); }
        setTimeout(() => reply("ä½ å¥½ï¼Œæˆ‘æ˜¯è“å±±äººã€‚\nä½ çš„çŸ¥è¯†åº“å·²å°±ç»ªã€‚", "stand"), 500);

    </script>
</body>
</html>
